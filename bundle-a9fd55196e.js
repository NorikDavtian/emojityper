window.requestIdleCallback||(window.requestIdleCallback=(e=>{const t=performance.now(),n=e.bind(null,{didTimeout:!1,timeRemaining:()=>Math.max(0,50-(performance.now()-t))});return window.setTimeout(n,1)}),window.cancelIdleCallback=(e=>window.clearTimeout(e))),navigator.sendBeacon||(navigator.sendBeacon=function(e,t){return new Promise((n,o)=>{const i=new XMLHttpRequest;i.open("POST",e,!0),i.onerror=o,i.onload=n,i.send(t)})});const arrowKeys=["Left","Right","Up","Down"];function arrowFromEvent(e){return e.key?e.key.startsWith("Arrow")?e.key:-1===arrowKeys.indexOf(e.key)?null:"Arrow"+e.key:null}function isKeyboardClick(e){return!(e instanceof MouseEvent)||(0===e.screenX&&0===e.detail||0===e.webkitForce)}let dummy;function copyText(e){dummy||((dummy=document.createElement("input")).style.position="fixed",dummy.style.opacity=0,document.body.appendChild(dummy)),dummy.value=e;try{dummy.hidden=!1,dummy.focus(),dummy.selectionStart=0,dummy.selectionEnd=dummy.value.length,document.execCommand("copy")}catch(e){return!1}finally{dummy.hidden=!0}return!0}const all=Array.from(input.querySelectorAll("button")),handler=e=>{const t=e.detail.trim(),n=Boolean(t);all.forEach(e=>e.disabled=!n)};typer.addEventListener("value",handler),handler({detail:typer.value});const buttonTextShow=500;function notifyParentCopy(){window.parent&&window.parent.postMessage("copy","*")}function cacheFor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e3,n={},o=0;return i=>{let r=n[i];return void 0===r&&(n[i]=r=e(i),++o>t&&(n={},o=0)),r}}function jsdecode(e){const t=e.length,n=[];for(let o=0;o<t;){const i=e.charCodeAt(o++)||0;if(i<55296||i>56319||o===t);else{const t=e.charCodeAt(o)||0;if(56320==(64512&t)){++o,n.push(65536+(1023&t)+((1023&i)<<10));continue}}n.push(i)}return n}!function(e,t){let n;const o=e.textContent;let i=!1;function r(){i&&(document.activeElement===e&&t.focus(),i=!1)}t.addEventListener("keydown",t=>{i||"Enter"!==t.key||t.repeat||(e.click(),e.focus(),i=!0,t.preventDefault())}),document.body.addEventListener("keyup",e=>{"Enter"===e.key&&r()}),e.addEventListener("click",s=>{s.preventDefault(),i||s.repeat||((()=>{const i=t.dataset.copy.trim().replace(/\s+/," ");if(!copyText(i))return console.warn("could not copy",i),!0;console.info("copied",i),ga("send","event","text","copy"),e.textContent=e.dataset.copied,e.classList.add("copied"),window.clearTimeout(n),n=window.setTimeout(t=>{e.textContent=o,e.classList.remove("copied"),r(),notifyParentCopy()},500)})(),isKeyboardClick(s)&&e.focus())})}(copy,typer);const runeZWJ=8205,runeCap=8419,runeVS16=65039,runeTagCancel=917631;function isSkinTone(e){return e>=127995&&e<=127999}function isFlagPoint(e){return e>=127462&&e<=127487}function isTag(e){return e>=917536&&e<917631}const skippable=[runeVS16,8419,917631];function emojiPointCount(e){return _emojiPointCount(jsdecode(e))}function _emojiPointCount(e){let t=0;const n=e.length;for(let o=0;o<n;++o){const n=e[o];n===runeZWJ?t-=2:-1!==skippable.indexOf(n)||isTag(n)||isSkinTone(n)||(isFlagPoint(n)&&e[o+1]!==runeVS16?++t:t+=2)}return 0===e.length?0:t<=2?1:t+1>>1}function*iterateEmoji(e){const t=jsdecode(e);yield*_iterateEmoji(t)}function*_iterateEmoji(e){let t={flag:!1,v:[]};const n=[t],o=e=>{t.flag!==e&&(t={flag:e,v:[]},n.push(t))},i=e.length;for(let r=0;r<i;++r){const i=e[r];if(isFlagPoint(i)&&e[r+1]!==runeVS16)o(!0),t.v.push(i);else if(-1!==skippable.indexOf(i)||isTag(i)||isSkinTone(i)||i===runeZWJ)o(!1),t.v.push(i);else{const e=t.v.length-1;-1!==e&&t.v[e]!==runeZWJ?(t={flag:!1,v:[i]},n.push(t)):t.v.push(i)}for(;n.length>1;){const e=n.shift();e.v.length&&(yield e.v)}}const r=n[0];r.v.length&&(yield r.v)}const fixedWidthEmoji=Boolean(/Mac|iP(hone|od|ad)/.exec(navigator.platform))||Boolean(/Android/.exec(navigator.userAgent))||!1,needsManWomanHack=Boolean(/Win/.exec(navigator.platform)),letterSpacing=1024,fontSize=100,hider=document.createElement("div");hider.style.overflow="hidden",hider.style.width="0px",hider.style.position="absolute",hider.setAttribute("href","https://github.com/samthor/ok-emoji");const measurer=document.createElement("div");function measure(){hider.getBoundingClientRect();return{width:measurer.offsetWidth,height:hider.offsetHeight}}measurer.style.display="inline-block",measurer.style.whiteSpace="nowrap",measurer.style.fontSize=`${fontSize}px`,measurer.style.lineHeight="normal",measurer.style.fontFamily="sans-serif",hider.appendChild(measurer),document.body.appendChild(hider),measurer.textContent="󿿽";const invalidBoxSize=measure();measurer.textContent="😂";const validEmojiSize=measure();measurer.style.letterSpacing=`${letterSpacing}px`;const fixedWidthMeasure=function(){if(!fixedWidthEmoji)return null;const e=document.createElement("canvas").getContext("2d");e.font="10.5px monospace";const t=e.measureText("😂").width;return function(n){return e.measureText(n).width/t}}();function countRenderPoints(e){return measurer.textContent=e,Math.round(measurer.offsetWidth/(letterSpacing+fontSize))}const countExtraAllowed=needsManWomanHack?e=>{let t=0,n=-1;for(;-1!==(n=e.indexOf("‍\ud83d",n+1));){const o=e.charCodeAt(n+2);56424!==o&&56425!==o||++t}return t}:()=>0,isSingleValidEmoji=fixedWidthEmoji?function(e){return 1===fixedWidthMeasure(e)}:function(e){measurer.textContent=e;const t=measure(),n=1+countExtraAllowed(e);return!(Math.round(t.width/(letterSpacing+fontSize))>n)&&validEmojiSize.height===t.height&&invalidBoxSize.width!==t.width-letterSpacing},isExpectedLength=fixedWidthEmoji?function(e){const t=fixedWidthMeasure(e),n=emojiPointCount(e);return~~t===t&&t<=n}:function(e){if(measurer.textContent=e,hider.offsetHeight!==validEmojiSize.height)return!1;const t=jsdecode(e),n=_emojiPointCount(t)+countExtraAllowed(e);if(countRenderPoints(e)>n)return!1;for(const e of _iterateEmoji(t)){if(null===e)return!1;if(isFlagPoint(e[0])){if(e[1]===runeVS16)continue;if(e.length%2)return!1;for(let t=0;t<e.length;t+=2){const n=String.fromCodePoint(e[t],e[t+1]);if(!isSingleValidEmoji(n))return!1}continue}const t=String.fromCodePoint(...e);if(!isSingleValidEmoji(t))return!1}return!0},isSingle=cacheFor(isSingleValidEmoji),basicDiversity=isSingle("👨🏻"),skipDiversityList=[129309,128106,129340,128107,128108,128109];function skipDiversity(e){return-1!==skipDiversityList.indexOf(e)}function isPointGender(e){return 9792===e||9794===e}function isPersonGender(e){return 128104===e||128105===e}function isFamilyMember(e){return 128118===e||128102===e||128103===e}const genderFlip=function(){const e=[128104,128105,0,129334,127877,0,128131,128378,0,128112,129333,0,128103,128102,129490,128117,128116,129491,128109,128108,128107,128120,129332,0],t=new Map;for(let n=0;n<e.length;n+=3){const o={points:{f:e[n],m:e[n+1],n:e[n+2]}};for(let i=0;i<3;++i){const r=e[n+i];if(r){if(t.has(r))throw new Error("duplicate in gender list: "+r);t.set(r,o)}}}return e=>{const n=t.get(e)||null;return n&&void 0===n.single&&(n.single=isSingle(String.fromCodePoint(n.points.f))&&isSingle(String.fromCodePoint(n.points.m)),n.neutral=!!n.points.n&&isSingle(String.fromCodePoint(n.points.n))),n}}();function*reverseParts(e){let t=-1;do{const n=e.lastIndexOf(runeZWJ,t),o=n+1,i=-1===t?e.length:t+1;if(t=n-1,0===e.slice(o,i).length)continue;const r={part:e.slice(o,i),trailer:0!==o};yield r}while(-2!==t)}function splitPoints(e){let t=0;const n=[];for(;;){const o=e.indexOf(runeZWJ,t),i=-1===o?e.length:o,r=e.slice(t,i);if(0!==r.length&&n.push(r),-1===o)break;t=o+1}return n}function modify(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const n={tone:!1,gender:{single:!1,double:!1,neutral:!1}},o=void 0!==t?[]:null;e:for(const i of iterateEmoji(e)){o&&o.push(i);let e=0,r=!1;for(const o of reverseParts(i)){const i=o.part,s=o.trailer;if(void 0===t&&(n.tone||!basicDiversity)&&n.gender.neutral&&n.gender.single&&n.gender.double)break e;const a=i[0];if(isFlagPoint(a))continue;const l=isFamilyMember(a);s&&l&&(r=!0);const c=isPersonGender(a);if(l||c){n.tone=!r&&basicDiversity,n.gender.single=!0,c&&++e>=2&&(n.gender.double=!0);continue}if(r)continue;const d=genderFlip(a);if(null!==d&&(n.gender.single|=d.single,n.gender.neutral|=d.neutral),basicDiversity&&!n.tone&&!s&&!skipDiversity(a)){const e=String.fromCodePoint(a,127995);n.tone=isSingle(e)}if(!n.gender.neutral){const e=String.fromCodePoint(a,runeZWJ,9792,runeVS16),t=isSingle(e);n.gender.neutral=t,n.gender.single=n.gender.single||t}}}if(void 0===t)return n;if(void 0!==t.tone&&n.tone&&o.forEach(e=>{if(isSkinTone(e[1])){if(t.tone)e[1]=t.tone;else{const t=String.fromCodePoint(e[0]);isSingle(t)?e.splice(1,1):e[1]=runeVS16}return}if(!t.tone){const t=e.filter(e=>!isSkinTone(e));return void e.splice(0,e.length,...t)}if(skipDiversity(e[0]))return;const n=String.fromCodePoint(e[0],t.tone,...e.slice(1));isSingle(n)&&e.splice(1,0,t.tone)}),void 0!==t.gender){o.map(e=>splitPoints(e)).map((e,n)=>{if(isPointGender(e[e.length-1][0])){if(!t.gender)return e.pop(),e}else{let i=[],r=!1;for(let n=0;n<e.length;++n){const o=e[n],s=o[0],a=genderFlip(s);if(!a){if(0===n)break;continue}const l=(i=i.length?i:t.gender.split("")).shift();if(r&&(!l||isFamilyMember(s)))break;!l&&a.neutral?o[0]=a.points.n:l&&a.single&&(o[0]="m"===l?a.points.m:a.points.f),r=!0}if(r)return e;if(!t.gender)return null;const s=o[n].slice();s.push(runeZWJ,9792,runeVS16);const a=String.fromCodePoint(...s);if(!isSingle(a))return null;e.push([9792,runeVS16])}return e[e.length-1][0]="m"===t.gender[0]?9794:9792,e}).forEach((e,t)=>{if(null===e)return;const n=[];e.forEach(e=>{n.push(...e,runeZWJ)}),n.pop(),o[t]=n})}return n.out=o.map(e=>String.fromCodePoint(...e)).join(""),n}function letterAt(e,t){const n=e.charCodeAt(t);return e.charCodeAt(t+1)!==runeVS16&&(n<5e3&&n>32)}function match(e,t){let n=t,o=t;if(""===e.substr(t).trim()||!letterAt(e,t)){for(;o>0&&!(e.charCodeAt(o-1)>32);--o);o<n&&(n=o)}for(;n>0&&letterAt(e,n-1);--n);for(;o<e.length&&letterAt(e,o);++o);return n>o&&(n=o),{from:n,to:o}}function datasetSafeDelete(e){const t=e.dataset;for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];o.forEach(e=>{e in t&&delete t[e]})}const upgraded=new WeakMap;function cursorPosition(e){const t=upgraded.get(e);if(void 0!==t)return t()}function upgrade(e){if(upgraded.has(e))return!1;const t={from:e.selectionStart,to:e.selectionEnd},n=document.createElement("div");n.className="overflow-helper",e.parentNode.insertBefore(n,e);const o=document.createElement("div");o.className="underline",n.appendChild(o);let i=null;const r=document.createElement("div");r.className="autocomplete sizer",n.appendChild(r);const s=function(){const e=document.createElement("div");e.className="sizer",n.appendChild(e);const t=document.createElement("div");return t.className="nonce",n=>(e.textContent=n,e.appendChild(t),t.offsetLeft)}();upgraded.set(e,()=>{const t=~~((e.selectionStart+e.selectionEnd)/2);return s(e.value.substr(0,t))-e.scrollLeft}),"complete"!==document.readyState&&(o.classList.add("loading"),window.addEventListener("load",e=>{a(),o.classList.remove("loading")}));const a=()=>{if(t.from>=t.to)return o.hidden=!0,!1;const n=t.from,i=t.to,a=s(e.value.substr(0,n)),l=s(e.value.substr(n,i-n));l<0&&!document.getElementById("less")&&console.warn("invalid sizer width",l,"for text",sizer.textContent),o.hidden=l<=0,o.style.left=a+"px",o.style.width=l+"px",o.style.transform=`translateX(${-e.scrollLeft}px)`,r.style.transform=`translateX(${-e.scrollLeft+a+l}px)`},l=(n,i)=>(t.from=n,t.to=Math.max(n,i),n>=i?(datasetSafeDelete(e,"prefix","word","focus"),o.hidden=!0,!1):(e.dataset.focus=e.value.substr(n,i-n),a(),!0)),c=e.value.length,d={start:c,end:c,value:void 0};let u={},f=0;const h=(n,s)=>{n.has("select-all")?e.setSelectionRange(0,e.value.length):n.has("select-end")?e.setSelectionRange(e.value.length,e.value.length):!n.has("focus")||n.has("mousedown")||n.has("touchstart")||e.setSelectionRange(d.start,d.end),(n.has("blur")||n.has("focus"))&&(e.scrollLeft=f),f=e.scrollLeft;const a=(t=>{if(!1!==t&&e.selectionStart===d.start&&e.selectionEnd===d.end&&e.value===d.value)return!0;var n=[e.selectionStart,e.selectionEnd];if(d.start=n[0],d.end=n[1],d.value!==e.value&&(e.dispatchEvent(new CustomEvent("value",{detail:e.value})),d.value=e.value),d.start!==d.end)return datasetSafeDelete(e,"prefix","word"),l(d.start,d.end),o.classList.add("range"),e.classList.add("range"),!1;o.classList.remove("range"),e.classList.remove("range");const i=match(e.value,d.start),r=i.from,s=i.to;return!(r>=s&&t||(l(r,s)&&(e.dataset.focus=e.dataset.prefix=e.value.substr(r,s-r).toLowerCase(),datasetSafeDelete(e,"word")),1))})(s);if((()=>{const n=e.dataset.prefix||"";if(null===i||0===n.length||"^"!==i.name[0]&&i.name.substr(0,n.length)!==n||0!==e.value.substr(t.to).trim().length)return r.textContent="",!1;const o=("^"===i.name[0]?"":i.name.substr(n.length))+i.emoji;return r.textContent=o,!0})()||(i=null),e.selectionStart!==e.selectionEnd?e.dataset.copy=e.value.substr(e.selectionStart,e.selectionEnd-e.selectionStart):e.dataset.copy=null!==i?e.value.substr(0,t.from)+e.value.substr(t.to)+i.emoji:e.value,a)return;const c={text:e.dataset.focus?e.dataset.prefix||e.dataset.word||null:"",prefix:"prefix"in e.dataset,focus:e.dataset.focus,selection:e.selectionStart!==e.selectionEnd};c.text===u.text&&c.prefix===u.prefix&&c.focus===u.focus&&c.selection===u.selection||(u=c,e.dispatchEvent(new CustomEvent("query",{detail:c})))};let m,p=!1;function g(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e.selectionEnd<t.to)return!1;const o=e.dataset.prefix||"";if(0===o.length||!i||!i.name.startsWith(o))return!1;const r=e.value.substr(t.to),s=r.substr(0,e.selectionStart-t.to);if(0!==s.trim().length)return!1;if(n&&!s.length)return!1;if(0!==r.trim().length&&i.name!==o)return!1;ga("send","event","options","typing");const a={choice:i.emoji,word:i.name};return typer.dispatchEvent(new CustomEvent("emoji",{detail:a})),!0}!function(){let t,n=new Set;const o=e=>{t||(m=void 0,n.clear(),t=window.requestAnimationFrame(()=>{t=null,h(n,m)})),e&&n.add(e.type)};"change keydown keypress focus click mousedown touchstart select input select-all select-end blur".split(/\s+/).forEach(t=>e.addEventListener(t,o)),o(),e.addEventListener("suggest",e=>{i=e.detail,p&&g(),o()}),e.addEventListener("mousemove",e=>{e.which&&o()}),document.addEventListener("selectionchange",t=>{document.activeElement===e&&o()})}(),e.addEventListener("keydown",e=>{switch(p=!1,e.key){case"Escape":m=!1;break;case"ArrowDown":case"Down":case"ArrowUp":case"Up":return void e.preventDefault();case" ":const t=g();e.shiftKey&&e.preventDefault(),t||(p=!0)}}),e.addEventListener("keyup",e=>{229!==e.keyCode&&e.keyCode||g(!0)}),function(){let t;const n=()=>{t||(t=window.requestAnimationFrame(()=>{t=null,a()}))};window.addEventListener("resize",n),e.addEventListener("wheel",n,{passive:!0})}();const v=n=>{const o=e.scrollLeft,i=t.from,r=t.to,s=e.value.substr(i,r-i);let a=[typer.selectionStart,typer.selectionEnd],c=a[0],u=a[1];const f=typer.selectionDirection,h=n(s);if(null==h)return!1;const p=document.activeElement;typer.focus(),typer.selectionStart=i,typer.selectionEnd=r;const g=typer.value.substr(0,i)+h+typer.value.substr(r);document.execCommand("insertText",!1,h)&&typer.value===g||(typer.value=typer.value.substr(0,i)+h+typer.value.substr(r)),typer.dispatchEvent(new CustomEvent("change"));const v=e=>(e>=r?e=e-(r-i)+h.length:e>i&&(e=i+h.length),e);var w=[v(c),v(u)];return d.start=w[0],d.end=w[1],typer.setSelectionRange(d.start,d.end,f),p&&p.focus(),m=!0,e.scrollLeft=o,l(i,i+h.length),!0};e.addEventListener("modifier",e=>{const t={[e.detail.type]:e.detail.code};v(e=>modify(e,t).out)}),e.addEventListener("emoji",t=>{const n=t.detail.choice;v(()=>n)&&(e.dataset.word=t.detail.word||"",datasetSafeDelete(e,"prefix"))})}function build(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const o={},i={};return e.forEach(e=>{const r=e[0];i[r]=e.slice(1);const s=r.substr(0,t);for(let e=1;e<=s.length;++e){const t=s.substr(0,e);let i=o[t];i||(i=o[t]=[]),i.length<n&&i.push(r)}}),function(e,n){const r=(e=e.toLowerCase()).substr(t);let s=o[e.substr(0,t)]||[];return r&&(s=s.filter(e=>e.substr(t).startsWith(r))),n||(s=s.filter(t=>t===e)),(s=s.map(e=>[e,...i[e]])).length?s:[]}}function idle(){return new Promise(e=>window.requestIdleCallback(e))}function rAF(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return void 0!==e?new Promise(t=>{window.setTimeout(()=>window.requestAnimationFrame(t),e)}):new Promise(e=>window.requestAnimationFrame(e))}function microtask(){return Promise.resolve()}function delay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(t=>window.setTimeout(t,e))}upgrade(typer);const debouceMap=new Map;function debounce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=debouceMap.get(e);if(!n){n={c:e};const t=new Promise(e=>n.r=e);n.p=t.then(()=>(debouceMap.delete(e),n.c())),debouceMap.set(e,n)}return window.clearTimeout(n.t),n.t=window.setTimeout(n.r,Math.max(0,t)),n.p}function removeDuplicates(e){const t=new Set;return e.filter((e,n)=>{if(0!==n){if(t.has(e))return!1;t.add(e)}return!0})}function merge(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t.length)return[];const o={},i=t.shift();return i.forEach((e,t)=>o[e[0]]=t),t.forEach(e=>{e.forEach(e=>{const t=o[e[0]];if(void 0===t)return o[e[0]]=i.length,void i.push(e);const n=i[t],r=e.slice(1);i[t]=removeDuplicates(n.concat(r))})}),i}const options={abcd:[128289],abc:[128292],ab:[127374],a:[127344,65039],atm:[127975],cool:[127378],free:[127379],id:[127380],i:[8505,65039],m:[9410,65039],ok:[127383],o:[127358,65039],p:[127359,65039],sos:[127384],up:[127385],vs:[127386],"!!":[8252,65039],"!?":[8265,65039],"!":[10071],"?":[10067],$:[128178],"£":[128183],"€":[128182],"¥":[128180],new:[127381],ng:[127382],zzz:[128164],1234:[128290],cl:[127377],b:[127345,65039],wc:[128702],100:[128175],10:[128287],"*":[42,65039,8419],"#":[35,65039,8419],"<":[9664,65039],">":[9654,65039],"^":[128316],"+":[10133],"-":[10134],x:[10062],"~":[12336,65039]},keys=Object.keys(options);keys.sort((e,t)=>e.length!==t.length?t.length-e.length:e<t?-1:e>t?1:0);const matchPrefix=e=>{for(const t of keys)if(e.startsWith(t))return{length:t.length,points:options[t]};if(e[0]>="a"&&e[0]<="z"){return{length:1,points:[e.codePointAt(0)-97+127462,65039]}}if(e[0]>="0"&&e[0]<="9"){return{length:1,points:[e.codePointAt(0)-48+48,65039,8419]}}return null};function type(e){let t=e.toLowerCase();const n=[];for(;t.length;){const e=matchPrefix(t);if(null===e)return null;n.push(...e.points),t=t.substr(e.length)}return String.fromCodePoint(...n)}const api="https://emojibuff.appspot.com/api",recentLimit=16,selectionDelay=5e3;function loaderFor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const i=window.localStorage[e];if(i){let o;try{o=JSON.parse(i)}catch(t){console.debug("couldn't parse localStorage",e,t),o=null}if(o&&o.results&&(t=Promise.resolve(o.results),o.created>=+new Date-36e5*n))return()=>t}const r=new Promise((t,n)=>{const o=new XMLHttpRequest;o.open("GET",`${api}/${e}`),o.onerror=n,o.responseType="json",o.onload=(()=>t(o.response)),o.send()}).then(e=>"string"==typeof e?JSON.parse(e):e).then(n=>(t=r,n.created=+new Date,window.localStorage[e]=JSON.stringify(n),n.results));return t?()=>t:(o(!0),r.then(()=>o(!1)),()=>r)}const getPrefixGen=function(){const e=loaderFor("popular",24,e=>{window.loader.hidden=!e});return()=>e().then(e=>build(e))}(),getTrendingEmoji=function(){const e=loaderFor("hot",1);return()=>e().then(e=>{let t=[];return e.forEach(e=>{t=t.concat(e.slice(1))}),t})}();function request(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e){if(n&&""===e){const e=recent();return e.unshift("^recent"),getTrendingEmoji().then(t=>(t.unshift("^trending"),[e,t]))}return Promise.resolve([])}const o=[getPrefixGen().then(n=>n(e,t))];if(n){let n=`${api}/q?q=${window.encodeURIComponent(e)}`;t||(n+="&exact");const i=window.fetch(n).then(e=>e.json()).then(e=>e.results);o.push(i)}const i=type(e);return i&&o.push([["^type",i]]),Promise.all(o).then(e=>merge(...e))}const select=function(){let e={};const t=()=>{const t=JSON.stringify(e);return e={},navigator.sendBeacon(api+"/sel",t)};return function(n,o){if("^"===n[0])return;const i=recent(),r=i.indexOf(o);return-1!==r&&i.splice(r,1),i.unshift(o),i.splice(16),window.localStorage.recent=i.join(","),e[n]=o,debounce(t,5e3)}}();function submit(e,t){const n=new FormData;return n.append("name",e),n.append("emoji",t),window.fetch(api+"/name",{method:"POST",mode:"cors",body:n})}function recent(){return(window.localStorage.recent||"").split(",").filter(e=>e)}const allowedWorkTime=4,maximumTaskFrame=100;class Worker{constructor(e){this.fn_=e,this.queue_=[],this.waiting_=null,this.runner_().catch(e=>{throw console.info("worker runner failed",e),e})}async runner_(){for(await new Promise(e=>this.waiting_=e),this.waiting_=null,await idle();;){if(this.chunk_())return this.runner_();await rAF()}}chunk_(){const e=window.performance.now();let t=0;for(;this.queue_.length;){const n=this.queue_.shift();if(n.resolve(this.fn_(n.arg)),++t==maximumTaskFrame||window.performance.now()-e>allowedWorkTime)break}return!this.queue_.length}task(e){return new Promise(t=>{this.queue_.push({resolve:t,arg:e}),this.waiting_&&this.waiting_()})}}const dummyString="a",prefix="-ok_",ls=window.localStorage,known=new Map,ignoreValid=-1!==window.location.search.indexOf("ignore_valid");function runner(e){if(8203===e.charCodeAt(0))return!0;const t=isExpectedLength(e);return known.set(e,t),t&&(ls[prefix+e]=dummyString),t}const worker=new Worker(runner),task=ignoreValid?()=>!0:worker.task.bind(worker);function immediate(e){const t=known.get(e);return void 0!==t?t:ls[prefix+e]===dummyString||void 0}async function valid(e){const t=immediate(e);return void 0!==t?t:task(e)}async function findValidMatch(e,t){let n=!1;for(let o=0;o<e.length;++o){const i=e[o];for(let e=1;e<i.length;++e){const o=i[e];let r=immediate(o);if(void 0===r&&(n||(t(null),n=!0),r=await task(o)),r)return t({name:i[0],emoji:o})}}n||t(null)}class ButtonManager{constructor(e){this.holder_=e,this.options_=new Map,this.buttons_=new Map,this.buttonTarget_=new WeakMap,this.buttonPool_=[],window.requestIdleCallback(()=>{for(let e=0;e<10;++e)this.buttonPool_.push(document.createElement("button"))});const t=document.createElement("div");this.holder_.appendChild(t),this.setModifier=(()=>{const e=ButtonManager.optionType_("modifier","gender"),n=ButtonManager.optionType_("modifier","tone");t.appendChild(e),t.appendChild(n);const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=document.createElement("button");return n.textContent=e,n.dataset.value=t,n},i=[o("⚬",""),o("♀","f"),o("♀♂","fm"),o("♂","m"),o("♂♀","mf")],r=[o("—","")];for(let e=127995;e<=127999;++e)r.push(o(String.fromCodePoint(e),e));const s=(e,t,n)=>{e?n.appendChild(t):t.remove()};return function(o){const a=t.contains(document.activeElement)?document.activeElement:null;i.forEach(t=>{const n=t.dataset.value.length,i=!n&&o.gender.neutral||1===n&&o.gender.single||2===n&&o.gender.double;s(i,t,e)}),r.forEach(e=>s(o.tone,e,n)),t.insertBefore(e,e.nextSibling),t.insertBefore(n,n.nextSibling),a&&a.focus()}})()}static optionType_(e,t){const n=document.createElement("div");return n.className="options "+e,n.dataset[e]=t,n.dataset.name=t,n}optionForName_(e){const t=this.options_.get(e);if(t)return t;const n=document.createElement("div");return n.className="options",n.setAttribute("data-option",e),"^"===e[0]&&(n.classList.add("special"),e=e.substr(1)),n.setAttribute("data-name",e),n}addEmojiTo_(e,t){let n=this.buttons_.get(t);if(n){const t=this.buttonTarget_.get(n);if(null===t)return n;if(void 0===t)return e.appendChild(n),n}else(n=this.buttonPool_.pop()||document.createElement("button")).textContent=t,this.buttons_.set(t,n),valid(t).then(e=>{if(!e)return this.buttonTarget_.set(n,null);const t=this.buttonTarget_.get(n);t&&(t.parentNode.replaceChild(n,t),this.buttonTarget_.delete(n))});const o=document.createTextNode("");return this.buttonTarget_.set(n,o),e.appendChild(o),n}update(e){const t=new Map,n=new Map,o=this.holder_.contains(document.activeElement)?document.activeElement:null;e.forEach(e=>{const o=e[0],i="^"===o[0],r=this.optionForName_(o);t.set(o,r),this.options_.delete(o),this.holder_.appendChild(r);for(let e=0;e<r.children.length;++e){const t=r.children[e],o=t.textContent;i||n.has(o)?(t.remove(),this.buttonPool_.push(t),--e):n.set(o,t)}for(let t,o=1;t=e[o];++o)n.has(t)||n.set(t,this.addEmojiTo_(r,t))}),this.options_.forEach(e=>{for(let t=0;t<e.children.length;++t)this.buttonPool_.push(e.children[t]);e.remove()}),this.options_=t,this.buttons_=n,o&&(document.body.contains(o)?o.focus():typer.focus())}}let spaceFrame=0;chooser.addEventListener("keyup",e=>{" "===e.key&&"button"===e.target.localName&&(spaceFrame=window.setTimeout(()=>spaceFrame=0,0))});let previousChooserLeft=void 0,duringNavigate=!1;function navigateChooserButtonVertical(e){const t={dist:1/0,button:null},n=document.activeElement.getBoundingClientRect(),o=void 0!==previousChooserLeft?previousChooserLeft:n.left;let i=void 0;for(let s=0;s<e.length;++s){const a=e[s],l=a.getBoundingClientRect();if(n.top===l.top)continue;if(void 0===i)i=l.top;else if(l.top!==i)break;const c=Math.abs(l.left-o);if(c<t.dist){var r=[c,a];t.dist=r[0],t.button=r[1]}}if(!t.button)return!1;duringNavigate=!0;try{t.button.focus()}finally{duringNavigate=!1}return!0}chooser.addEventListener("focus",e=>{duringNavigate||(previousChooserLeft=document.activeElement.getBoundingClientRect().left)},!0),chooser.addEventListener("click",e=>{previousChooserLeft=void 0;const t=isKeyboardClick(e);let n=void 0;const o=e.target;if("button"!==o.localName);else if(o.parentNode.dataset.modifier){if(e.shiftKey)return;const t="value"in o.dataset?+o.dataset.value||o.dataset.value:null,i={type:o.parentNode.dataset.modifier,code:t};typer.dispatchEvent(new CustomEvent("modifier",{detail:i})),n="modifier"}else if(o.parentNode.dataset.option){if(e.shiftKey){copyText(o.textContent)&&ga("send","event","options","copy");const e=document.scrollingElement.scrollTop;return t?o.focus():typer.focus(),void(document.scrollingElement.scrollTop=e)}const i=0!==spaceFrame||e.metaKey||e.ctrlKey?o.parentNode.dataset.option:null,r={choice:o.textContent,word:i};typer.dispatchEvent(new CustomEvent("emoji",{detail:r})),select(o.parentNode.dataset.option,r.choice),n="emoji"}n&&(ga("send","event","options","click",n),t||typer.focus())}),typer.addEventListener("keydown",e=>{if("ArrowDown"===e.key||"Down"===e.key){const e=typer.getBoundingClientRect();previousChooserLeft=e.left+cursorPosition(typer),navigateChooserButtonVertical(chooser.querySelectorAll("button"))&&ga("send","event","options","keyboardnav")}else if("ArrowRight"===e.key||"Right"===e.key){const e=typer.value.length;if(typer.selectionEnd===e&&typer.selectionStart===e){const e=chooser.querySelector("button");e&&e.focus()}}}),chooser.addEventListener("keydown",e=>{const t=arrowFromEvent(e);if(!t)return;if(!chooser.contains(document.activeElement))return;const n=Array.from(chooser.querySelectorAll("button")),o=n.indexOf(document.activeElement);if(-1===o)return;let i,r;if("ArrowLeft"===t?i=-1:"ArrowRight"===t&&(i=1),i){const e=o+i;e>=0&&e<n.length?n[e].focus():e<0&&(typer.focus(),typer.dispatchEvent(new CustomEvent("select-end")))}else{if("ArrowUp"===t)(r=n.slice(0,o)).reverse();else{if("ArrowDown"!==t)return;r=n.slice(o)}if(navigateChooserButtonVertical(r)||"ArrowUp"===t&&typer.focus(),"ArrowDown"===t){const t=document.activeElement.getBoundingClientRect(),n=t.top+t.height;window.innerHeight-n>64&&e.preventDefault()}}}),function(){const e=new ButtonManager(chooser);let t={},n=performance.now(),o=[],i=0;function r(e){const t=++i;if(!e)return void typer.dispatchEvent(new CustomEvent("suggest",{detail:null}));let n=null;const r=o.slice().filter(t=>e.length>1&&t[0]===e?(n=t,!1):t[0].startsWith(e)||"^"===t[0][0]);n&&r.unshift(n);findValidMatch(r,e=>{t===i&&typer.dispatchEvent(new CustomEvent("suggest",{detail:e}))})}typer.addEventListener("query",i=>{const s=i.detail,a=performance.now(),l=modify(!i.detail.prefix&&i.detail.focus||"");e.setModifier(l),t.text!==s.text&&r(s.text);const c=t.text&&s.text&&0!==t.text.length&&t.text.startsWith(s.text.substr(0,t.text.length))||!1;let d=!1;t.text&&t.prefix===s.prefix?a-n>2e3&&(d=!0):d=!0,t=s,n=a;const u=async function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n&&(await rAF(n),t!==s))return-1;const a=await request(s.text,s.prefix,i);return t!==s?-1:(o=a,r(s.text),e.update(a))};u(d?0:250,c).then(e=>{if(e<0)return-2;if(!s.text){const e=window.innerHeight<=400?0:750;return u(e,!0)}const t=Math.max(1e3,100*Math.pow(e,.75));return u(t,!0)}).catch(e=>{console.error("error doing request",e)})})}(),function(e,t){const n=t.querySelector("form"),o=n.querySelector("input"),i=n.querySelector("button");let r="",s=null;e.addEventListener("query",e=>{const n=e.detail,i=null===n.text&&void 0!==n.focus&&n.selection;if(r=n.focus,!i)return s||(o.value="",t.hidden=!0),!1;t.hidden=!1});const a=e=>{i.disabled=!o.value};"input change".split(/\s+/).forEach(e=>o.addEventListener(e,a)),n.addEventListener("submit",e=>{if(e.preventDefault(),s)return!1;n.classList.add("pending"),o.disabled=!0,i.disabled=!0;(s=submit(o.value,r).then(e=>{if(!e.ok)throw new Error(e.status);return i.classList.add("success"),!1}).catch(e=>(i.classList.add("failure"),console.warn("failed to submit emoji",e),!0)).then(e=>{n.classList.remove("pending"),o.disabled=!1,o.value="",o.dispatchEvent(new CustomEvent("change")),s=null,r||(t.hidden=!0)})).then(()=>delay(2e3)).then(()=>{i.className=""})})}(typer,advanced);const value=e=>{const t=e.detail.trim();document.body.classList.toggle("has-value",Boolean(t))};function isExtentNode(e){return e instanceof Element&&e.classList.contains("extent")}typer.addEventListener("value",value),value({detail:typer.value}),document.body.addEventListener("keydown",e=>{switch(e.key){case"Escape":if(document.activeElement!==typer){typer.focus();break}if(typer.selectionStart!==typer.selectionEnd){"backward"===typer.selectionDirection?typer.selectionStart=typer.selectionEnd:typer.selectionEnd=typer.selectionStart;break}const t=typer.value.length;typer.setSelectionRange(t,t)}}),document.addEventListener("selectionchange",e=>{const t=window.getSelection(),n=t.anchorNode,o=t.focusNode;n!==o&&isExtentNode(n)&&isExtentNode(o)&&(t.removeAllRanges(),typer.focus(),typer.dispatchEvent(new CustomEvent("select-all")))},!0),document.addEventListener("focusin",e=>{microtask().then(()=>{document.activeElement===document.body&&typer.focus()})});const resize=e=>{const t=window.innerHeight;document.body.style.minHeight=`${t}px`};window.addEventListener("resize",resize),window.addEventListener("load",resize),resize(),document.body.addEventListener("click",e=>{const t=e.target&&e.target.closest("a[href]");t&&ga("send","event","outbound","click",t.href)}),window.setTimeout(()=>{const e=(window.localStorage.sources||"").split(",").filter(Boolean),t=/utm_source=([_\w\d]*)/.exec(window.location.search);t&&(-1===e.indexOf(t[1])&&e.push(t[1]),window.localStorage.sources=e.join(",")),e.length||window.localStorage["dismiss-install"]||(document.querySelector("footer").addEventListener("click",e=>{e.target.classList.contains("dismiss-install")&&(ga("send","event","install","dismiss"),window.localStorage["dismiss-install"]=!0,document.body.removeAttribute("data-install"))}),document.body.dataset.install||(navigator.userAgent.match(/Chrome\//)&&navigator.platform.match(/^(Mac|Win|Linux)/)?document.body.dataset.install="ext":"undefined"==typeof Windows&&navigator.platform.startsWith("Win")&&(document.body.dataset.install="windows")))},2500),function(){let e=null;function t(){document.body.removeAttribute("data-install"),e=null}window.addEventListener("beforeinstallprompt",t=>(ga("send","event","install","available"),document.body.dataset.install="pwa",e=t,t.preventDefault(),!1)),window.addEventListener("appinstalled",e=>{ga("send","event","install","installed"),t()}),document.getElementById("install").addEventListener("click",n=>{e&&(e.prompt(),e.userChoice&&e.userChoice.then(e=>{ga("send","event","install",e)}).catch(e=>{console.warn("beforeinstallprompt prompt",e)}).then(t))})}();const adverts=document.getElementById("adverts");function refresh(){const e=adverts.querySelector(".active"),t=e&&e.nextElementSibling||adverts.firstElementChild;t?(e&&e.classList.remove("active"),t.classList.add("active"),enqueue()):console.warn("no adverts to choose from")}let timeout;function enqueue(){window.clearTimeout(timeout),timeout=window.setTimeout(()=>{window.requestAnimationFrame(refresh)},1e4)}if(enqueue(),navigator.serviceWorker){navigator.serviceWorker.register("./sw.js").catch(e=>{console.warn("failed to register SW",e)});const e=Boolean(navigator.serviceWorker.controller);navigator.serviceWorker.addEventListener("controllerchange",()=>{e&&(console.debug("got SW controllerchange, reload"),window.location.reload())})}let prevOnLine=!0;function notifyStatus(){"onLine"in navigator&&prevOnLine!==navigator.onLine&&(ga("send","event","network",navigator.onLine?"online":"offline"),prevOnLine=navigator.onLine)}notifyStatus(),window.addEventListener("online",()=>debounce(notifyStatus)),window.addEventListener("offline",()=>debounce(notifyStatus));const placeholders=["Type words, receive emoji 👍","Use your keyboard to search 🔎","Find emoji that your heart desires ❤️⌨️","Keyboard. Emoji. Forever 😍","Keyboard emoji since 2016 📜","Just tap a key to search 👆","Type, tap enter to copy, profit 💸","Emoji for every occasion, just type 🔡"],choice=Math.floor(Math.random()*placeholders.length);typer.placeholder=placeholders[choice],window.onerror=((e,t,n,o,i)=>{console.info("got err",String(e));try{ga("send","event","error",`${t},${n}:${o}`,String(e),{nonInteraction:!0})}catch(e){}});

//# sourceMappingURL=bundle-a9fd55196e.js.map