{"version":3,"file":"54848747.js","sources":["src/selection.js","src/adverts.js","src/placeholders.js","src/sw.js","src/offline.js","src/install-hints.js"],"sourcesContent":["\nimport * as provider from './lib/provider.js';\nimport * as promises from './lib/promises.js';\n\n// advanced handler\n(function(input, advanced) {\n  const form = advanced.querySelector('form');\n  const namer = form.querySelector('input');\n  const button = form.querySelector('button');\n\n  let value = '';\n  let pending = null;\n\n  input.addEventListener('query', (ev) => {\n    const query = ev.detail;\n    const selection = (query.text === null && query.focus !== undefined && query.selection);\n    value = query.focus;\n    if (!selection) {\n      if (!pending) {\n        namer.value = '';  // clear on done if not pending\n        advanced.hidden = true;\n      }\n      return false;\n    }\n    // TODO: round trip to confirm validity of emoji?\n    advanced.hidden = false;\n  });\n\n  const handler = ev => {\n    button.disabled = !namer.value;\n  };\n  'input change'.split(/\\s+/).forEach(type => namer.addEventListener(type, handler));\n\n  form.addEventListener('submit', (ev) => {\n    ev.preventDefault();\n    if (pending) {\n      return false;  // can't submit while running\n    }\n\n    form.classList.add('pending');\n    namer.disabled = true;\n    button.disabled = true;\n\n    const cleanup = _ => {\n      form.classList.remove('pending');\n      namer.disabled = false;\n      namer.value = '';\n      namer.dispatchEvent(new CustomEvent('change'));\n\n      pending = null;\n      if (!value) {\n        advanced.hidden = true;\n      }\n    };\n\n    pending = provider.submit(namer.value, value).then((response) => {\n      if (!response.ok) {\n        throw new Error(response.status);\n      }\n      button.classList.add('success');\n      return false;\n    }).catch(err => {\n      button.classList.add('failure');\n      console.warn('failed to submit emoji', err);\n      return true;\n    }).then(cleanup);\n\n    pending.then(() => promises.delay(2000)).then(() => {\n      button.className = '';\n    });\n  });\n}(typer, advanced));\n","import {rAF} from './lib/promises.js';\n\n/**\n * @fileoverview Rotates through various advertisements in Emojityper.\n */\n\nconst delay = 10 * 1000;\nconst initialDelay = 2 * delay;\n\nconst rotate = document.getElementById('rotate');\nconst all = Array.from(rotate.children);  // nb. these are in DOM for SEO\n\nasync function run() {\n  await rAF(initialDelay);\n\n  const initial = all.shift();\n  initial.classList.remove('active');\n  all.sort(() => Math.random() - 0.5);\n\n  for (;;) {\n    all[0].classList.add('active');\n    await rAF(delay);\n\n    all[0].classList.remove('active');\n    all.push(all.shift());\n  }\n}\n\nrun().catch(console.warn);\n\n","\nconst placeholders = [\n  'Type words, receive emoji 👍',\n  'Use your keyboard to search 🔎',\n  'Find emoji that your heart desires ❤️⌨️',\n  'Keyboard. Emoji. Forever 😍',\n  'Keyboard emoji since 2016 📜',\n  'Just tap a key to search 👆',\n  'Type, tap enter to copy, profit 💸',\n  'Emoji for every occasion, just type 🔡',\n];\n\nconst choice = Math.floor(Math.random() * placeholders.length);\ntyper.placeholder = placeholders[choice];\n","\nif (navigator.serviceWorker) {\n  navigator.serviceWorker.register('./sw.js').catch((err) => {\n    console.warn('failed to register SW', err);\n  });\n\n  const hadInitialController = Boolean(navigator.serviceWorker.controller);\n  navigator.serviceWorker.addEventListener('controllerchange', () => {\n    if (hadInitialController) {\n      // only reload if we had a SW on load\n      console.debug('got SW controllerchange, reload');\n      window.location.reload();\n    } else {\n      // this is the very first SW, so reloading doesn't help us\n    }\n  });\n}\n","\nimport {debounce} from './lib/promises.js';\n\nlet prevOnLine = true;\n\nfunction notifyStatus() {\n  if ('onLine' in navigator && prevOnLine !== navigator.onLine) {\n    ga('send', 'event', 'network', navigator.onLine ? 'online' : 'offline');\n    prevOnLine = navigator.onLine;\n  }\n}\n\nnotifyStatus();\nwindow.addEventListener('online', () => debounce(notifyStatus));\nwindow.addEventListener('offline', () => debounce(notifyStatus));\n","\n// install code, delay by ~2500ms on load\n\nwindow.setTimeout(() => {\n  const dismissKey = 'dismiss-install';\n  const sourceKey = 'sources';\n  const sources = (window.localStorage[sourceKey] || '').split(',').filter(Boolean);\n\n  const sourceMatch = /utm_source=([_\\w\\d]*)/;\n  const m = sourceMatch.exec(window.location.search);\n  if (m) {\n    if (sources.indexOf(m[1]) === -1) {\n      sources.push(m[1]);\n    }\n    window.localStorage[sourceKey] = sources.join(',');\n  }\n\n  if (sources.length || window.localStorage[dismissKey]) {\n    return;  // we have been installed somewhere already\n  }\n\n  const footer = document.querySelector('footer');\n  footer.addEventListener('click', (ev) => {\n    if (!ev.target.classList.contains('dismiss-install')) {\n      return;\n    }\n    ga('send', 'event', 'install', 'dismiss');\n    window.localStorage[dismissKey] = true;\n    document.body.removeAttribute('data-install');\n  });\n\n  // TODO(samthor): Allow showing both ext/windows on say, Chrome Windows.\n  if (document.body.dataset['install']) {\n    // we probably got pipped to the post by PWA install, great\n  } else if (navigator.userAgent.match(/Chrome\\//) && navigator.platform.match(/^(Mac|Win|Linux)/)) {\n    // We're Chrome on some kind of desktop\n    document.body.dataset['install'] = 'ext';\n  } else if (typeof Windows === 'undefined' && navigator.platform.startsWith('Win')) {\n    // 'Windows' not found (not already installed), and on Windows\n    document.body.dataset['install'] = 'windows';\n  }\n\n}, 2500);\n\n// PWA install code below, run immediately\n\n(function() {\n\n  let deferredPrompt = null;\n\n  function cleanupPrompt() {\n    document.body.removeAttribute('data-install');\n    deferredPrompt = null;\n  }\n\n  window.addEventListener('beforeinstallprompt', (ev) => {\n    ga('send', 'event', 'install', 'available');\n    document.body.dataset['install'] = 'pwa';\n    deferredPrompt = ev;\n    ev.preventDefault();\n    return false;\n  });\n\n  window.addEventListener('appinstalled', (ev) => {\n    ga('send', 'event', 'install', 'installed');\n    cleanupPrompt();\n  });\n\n  const installEl = document.getElementById('install');\n  installEl.addEventListener('click', (ev) => {\n    if (!deferredPrompt) {\n      return;\n    }\n    deferredPrompt.prompt();\n\n    if (!deferredPrompt.userChoice) {\n      return;  // older Chrome\n    }\n\n    deferredPrompt.userChoice.then((result) => {\n      ga('send', 'event', 'install', result);\n      // TODO: should we listen to appinstalled? I suppose we don't know what the user said.\n    }).catch((err) => {\n      console.warn('beforeinstallprompt prompt', err);\n    }).then(cleanupPrompt);\n  });\n\n}());\n"],"names":["input","advanced","form","querySelector","namer","button","value","pending","addEventListener","ev","query","detail","selection","text","undefined","focus","hidden","handler","disabled","split","forEach","type","preventDefault","classList","add","provider","then","response","ok","Error","status","catch","err","console","warn","_","remove","dispatchEvent","CustomEvent","promises","className","typer","delay","initialDelay","rotate","document","getElementById","all","Array","from","children","async","rAF","shift","sort","Math","random","push","run","placeholders","choice","floor","length","placeholder","navigator","serviceWorker","register","hadInitialController","Boolean","controller","debug","window","location","reload","prevOnLine","notifyStatus","onLine","ga","debounce","setTimeout","sources","localStorage","filter","m","exec","search","indexOf","join","target","contains","body","removeAttribute","dataset","userAgent","match","platform","Windows","startsWith","deferredPrompt","cleanupPrompt","prompt","userChoice","result"],"mappings":"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"}