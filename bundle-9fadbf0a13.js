window.requestIdleCallback||(window.requestIdleCallback=(e=>{const t=performance.now(),n=e.bind(null,{didTimeout:!1,timeRemaining:()=>Math.max(0,50-(performance.now()-t))});return window.setTimeout(n,1)}),window.cancelIdleCallback=(e=>window.clearTimeout(e))),navigator.sendBeacon||(navigator.sendBeacon=function(e,t){return new Promise((n,o)=>{const r=new XMLHttpRequest;r.open("POST",e,!0),r.onerror=o,r.onload=n,r.send(t)})});const arrowKeys=["Left","Right","Up","Down"];function arrowFromEvent(e){return e.key?e.key.startsWith("Arrow")?e.key:-1===arrowKeys.indexOf(e.key)?null:"Arrow"+e.key:null}function isKeyboardClick(e){return e instanceof MouseEvent&&0===e.screenX&&0===e.detail}let dummy;function copyText(e){dummy||((dummy=document.createElement("input")).style.position="fixed",dummy.style.opacity=0,document.body.appendChild(dummy)),dummy.value=e;try{dummy.hidden=!1,dummy.focus(),dummy.selectionStart=0,dummy.selectionEnd=dummy.value.length,document.execCommand("copy")}catch(e){return!1}finally{dummy.hidden=!0}return!0}const all=Array.from(buttons.querySelectorAll("button")),handler=e=>{const t=e.detail.trim(),n=Boolean(t);all.forEach(e=>e.disabled=!n)};typer.addEventListener("value",handler),handler({detail:typer.value}),function(e,t){let n;const o=e.textContent,r=/\s*/;let i=!1;function s(){i&&(document.activeElement===e&&t.focus(),i=!1)}t.addEventListener("keydown",t=>{i||"Enter"!==t.key||t.repeat||(e.click(),e.focus(),i=!0,t.preventDefault())}),document.body.addEventListener("keyup",e=>{"Enter"===e.key&&s()}),e.addEventListener("click",a=>{a.preventDefault(),i||a.repeat||((()=>{let i=0,a=t.value.length;if(t.selectionStart!==t.selectionEnd&&(i=t.selectionStart,a=t.selectionEnd),(a=(i+=r.exec(t.value.substr(i))[0].length)+t.value.substr(i,a-i).trim().length)<=i)return;const c=t.value.substr(i,a-i);if(!copyText(c))return console.warn("could not copy",c),!0;console.info("copied",c),ga("send","event","text","copy"),e.textContent=e.dataset.copied,window.clearTimeout(n),n=window.setTimeout(t=>{e.textContent=o,s()},500)})(),isKeyboardClick(a)&&e.focus())})}(copy,typer);const canvas=document.createElement("canvas"),context=canvas.getContext("2d");context.font="1px monospace";const measureText=function(){let e={},t=0;return n=>{let o=e[n];return void 0===o&&(e[n]=o=context.measureText(n).width,++t>4e3&&(e={},t=0)),o}}(),fixedWidthEmoji=Boolean(/Mac|Android|iP(hone|od|ad)/.exec(navigator.platform)),isSingle=function(){const e=-1!==window.location.search.indexOf("debug"),t=measureText("\u{1f602}");if(fixedWidthEmoji)return e?(console.info("fixed emoji width is",t,"for \u{1f602}"),e=>{const n=measureText(e)===t;return n||console.debug("isSingle can't render",e,"width",measureText(e)),n}):e=>measureText(e)===t;const n=context.measureText("\u{ffffd}").width,o=context.measureText("a").width;return e&&console.info("invalid char has width",n,"ascii char has width",o),r=>{const i=measureText(r);return e&&console.debug("isSingle",r,"has width",i),i!==n&&i<2*n&&i>o||i===t}}(),isExpectedLength=function(){if(fixedWidthEmoji){const e=measureText("\u{1f602}");return t=>{const n=splitEmoji(jsdecode(t)),o=n.reduce((e,t)=>e+=isFlagPoint(t[0].point)?1:0,0),r=n.length-Math.ceil(o/2),i=measureText(t)/e;return Math.floor(i)===i&&i<=r}}context.measureText("\u{ffffd}").width;return e=>{const t=splitEmoji(jsdecode(e)),n=t.length;for(let o=0;o<n;++o){const e=t[o];if(0===e.length&&isFlagPoint(e[0].point))continue;const n=String.fromCodePoint(...e.map(e=>e.point));if(!isSingle(n))return!1}return!0}}(),basicDiversity=measureText("\u{1f468}\u{1f3fb}")===measureText("\u{1f468}");function isPointGender(e){return 9792===e||9794===e}function isPersonGender(e){return 128104===e||128105===e}function isFamilyMember(e){return 128118===e||128102===e||128103===e}function isVariationSelector(e){return e>=65024&&e<=65039||e>=917760&&e<=917999}function isDiversitySelector(e){return e>=127995&&e<=127999}function isFlagPoint(e){return e>=127462&&e<=127487}function unlikelyModifierBase(e){return e<9757||isPointGender(e)||isVariationSelector(e)||isDiversitySelector(e)||isFlagPoint(e)}function jsdecode(e){const t=e.length,n=[];for(let o=0;o<t;){const r=e.charCodeAt(o++)||0;if(r<55296||r>56319||o===t);else{const t=e.charCodeAt(o)||0;if(56320==(64512&t)){++o,n.push(65536+(1023&t)+((1023&r)<<10));continue}}n.push(r)}return n}const genderFlip=function(){const e=[129334,127877,0,128131,128378,0,128112,129333,0,128103,128102,129490,128117,128116,129491,128109,128108,0,128120,129332,0],t=new Map;for(let n=0;n<e.length;n+=3){const o={points:{f:e[n],m:e[n+1],n:e[n+2]}};for(let r=0;r<3;++r){const i=e[n+r];if(i){if(t.has(i))throw new Error("duplicate in gender list: "+i);t.set(i,o)}}}return e=>{const n=t.get(e)||null;return n&&void 0===n.single&&(n.single=isSingle(String.fromCodePoint(n.points.f))&&isSingle(String.fromCodePoint(n.points.m)),n.neutral=n.points.n&&isSingle(String.fromCodePoint(n.points.n))),n}}();function splitEmoji(e){if(!e.length)return[];let t=[{point:e[0],suffix:0}];const n=[t];for(let o=1;o<e.length;++o){const r=e[o];if(isFlagPoint(t[t.length-1].point));else{if(isDiversitySelector(r)||isVariationSelector(r)){t[t.length-1].suffix=r;continue}if(8205===r){const n=e[++o];n&&t.push({point:n,suffix:0});continue}}t=[{point:r,suffix:0}],n.push(t)}return n}function modify(e,t){const n={tone:!1,gender:{single:!1,double:!1,neutral:!1}};if(!e)return n;const o=splitEmoji(jsdecode(e)),r=t?[]:null;if(o.some((e,t)=>{const o=e[0].point;let i=0,s=!1;e.forEach(e=>{const t=e.point;if(isPointGender(t))n.gender.single=!0,n.gender.neutral=!0;else if(isPersonGender(t))n.gender.single=!0,++i>=2&&(n.gender.double=!0);else if(isFamilyMember(t)&&i)s=!0;else{const e=genderFlip(t);e&&(n.gender.single|=e.single,n.gender.neutral|=e.neutral)}});const a=i?isPersonGender(o)&&1===i&&!s:void 0;if(a&&(n.tone=basicDiversity),r&&(r[t]=a),(n.tone||!basicDiversity)&&n.gender.neutral)return!r&&n.gender.single&&n.gender.double;if(!1===a||unlikelyModifierBase(o))return;const c=String.fromCodePoint(o);basicDiversity&&!n.tone&&isSingle(c+"\u{1f3fb}")&&(n.tone=!0),!n.gender.neutral&&isSingle(c+"\u200d\u2640\ufe0f")&&(n.gender.neutral=!0,n.gender.single=!0)}),!t)return n;const i=function(){const e=t.gender||"";let n,o;return(t,r,i)=>{void 0===n||t!==n?(n=t,o=0):++o;const s=e?e[o%e.length]:"",a=r||0;if(isPersonGender(a))return s?"m"===s?128104:128105:a;if(!a||isPointGender(a))return s?"m"===s?9794:9792:0;if(i){const e=genderFlip(a);if(e){if(!s&&e.neutral)return e.points.n;if(s&&e.single)return"m"===s?e.points.m:e.points.f}}return--o,a}}(),s=o.map((e,n)=>{const o=[],s=r[n],a=e[0].point;if(void 0!==t.gender){const t=void 0===s;if(e.forEach(e=>e.point=i(o,e.point,t)),void 0===s&&1===e.length&&!isPointGender(a)){const t=i(o);t&&isSingle(String.fromCodePoint(a)+"\u200d\u2640\ufe0f")&&e.push({suffix:65039,point:t})}}return void 0!==t.tone&&e.forEach((e,n)=>{isDiversitySelector(e.suffix)?e.suffix=t.tone:0===n&&basicDiversity&&!1!==s&&(s||isSingle(String.fromCodePoint(a)+"\u{1f3fb}"))&&(e.suffix=t.tone)}),e.forEach(e=>{e.point&&(o.length&&o.push(8205),o.push(e.point),e.suffix&&o.push(e.suffix))}),o}).reduce((e,t)=>e.concat(t),[]);return n.out=String.fromCodePoint(...s),n}function letterAt(e,t){const n=e.charCodeAt(t);return 65039!==e.charCodeAt(t+1)&&(n<5e3&&n>32)}function match(e,t){let n=t,o=t;if(""===e.substr(t).trim()||!letterAt(e,t)){for(;o>0&&!(e.charCodeAt(o-1)>32);--o);o<n&&(n=o)}for(;n>0&&letterAt(e,n-1);--n);for(;o<e.length&&letterAt(e,o);++o);return n>o&&(n=o),{from:n,to:o}}function datasetSafeDelete(e,...t){const n=e.dataset;t.forEach(e=>{e in n&&delete n[e]})}const upgraded=new WeakMap;function cursorPosition(e){const t=upgraded.get(e);if(void 0!==t)return t()}function upgrade(e){if(upgraded.has(e))return!1;const t=document.createElement("div");t.className="overflow-helper",e.parentNode.insertBefore(t,e);const n=document.createElement("div");n.className="underline",t.appendChild(n);const o=function(){const e=document.createElement("div");e.className="sizer",t.appendChild(e);const n=document.createElement("div");return n.className="nonce",t=>(e.textContent=t,e.appendChild(n),n.offsetLeft)}();upgraded.set(e,()=>{const t=~~((e.selectionStart+e.selectionEnd)/2);return o(e.value.substr(0,t))-e.scrollLeft}),"complete"!==document.readyState&&(n.classList.add("loading"),window.addEventListener("load",e=>{r(),n.classList.remove("loading")}));const r=()=>{if(void 0===e.dataset.from)return n.hidden=!0,!1;const[t,r]=[+e.dataset.from,+e.dataset.to],i=o(e.value.substr(0,t)),s=o(e.value.substr(t,r-t));s<0&&!document.getElementById("less")&&console.warn("invalid sizer width",s,"for text",sizer.textContent),n.hidden=s<=0,n.style.left=i+"px",n.style.width=s+"px",n.style.transform=`translateX(-${e.scrollLeft}px)`},i=(t,o)=>([e.dataset.from,e.dataset.to]=[t,o],t>=o?(datasetSafeDelete(e,"prefix","word","focus"),n.hidden=!0,!1):(e.dataset.focus=e.value.substr(t,o-t),r(),!0)),s=e.value.length,a={start:s,end:s,value:void 0};let c={};const l=(t,o)=>{if(t.has("focus")&&a.start===a.end&&([e.selectionStart,e.selectionEnd]=[a.start,a.end]),(t=>{if(!1!==t&&e.selectionStart===a.start&&e.selectionEnd===a.end&&e.value===a.value)return!0;if([a.start,a.end]=[e.selectionStart,e.selectionEnd],a.value!==e.value&&(e.dispatchEvent(new CustomEvent("value",{detail:e.value})),a.value=e.value),a.start!==a.end)return datasetSafeDelete(e,"prefix","word"),i(a.start,a.end),n.classList.add("range"),e.classList.add("range"),!1;n.classList.remove("range"),e.classList.remove("range");const{from:o,to:r}=match(e.value,a.start);o>=r&&t||i(o,r)&&(e.dataset.focus=e.dataset.prefix=e.value.substr(o,r-o),datasetSafeDelete(e,"word"))})(o))return;let r=e.dataset.prefix||e.dataset.word||null;e.dataset.focus||(r="");const s={text:r,prefix:"prefix"in e.dataset,focus:e.dataset.focus,selection:e.selectionStart!==e.selectionEnd};s.text===c.text&&s.prefix===c.prefix&&s.focus===c.focus&&s.selection===c.selection||(c=s,e.dispatchEvent(new CustomEvent("query",{detail:s})))};let d;!function(){let t,n=new Set;const o=e=>{t||(d=void 0,n.clear(),t=window.requestAnimationFrame(()=>{t=null,l(n,d)})),e&&n.add(e.type)};"change keydown keypress focus click mousedown select input".split(/\s+/).forEach(t=>e.addEventListener(t,o)),o(),e.addEventListener("mousemove",e=>{e.which&&o()}),document.addEventListener("selectionchange",t=>{document.activeElement===e&&o()});let r=!1;e.addEventListener("blur",t=>{e.scrollLeft&&(r=e.scrollLeft||!1),e.selectionStart===a.start&&e.selectionStart===a.end||([e.selectionStart,e.selectionEnd]=[a.start,a.end])},!0),e.addEventListener("focusout",t=>{!1!==r&&(e.scrollLeft=r,r=!1)},!0)}(),e.addEventListener("keydown",t=>{switch(t.key){case"Escape":d=!1;break;case"ArrowDown":case"Down":case"ArrowUp":case"Up":return void t.preventDefault();case" ":e.dataset.prefix&&e.selectionStart===+e.dataset.to&&e.dispatchEvent(new CustomEvent("request",{detail:e.dataset.prefix}))}}),e.addEventListener("keyup",t=>{if(229===t.keyCode||!t.keyCode){" "===e.value.substr(e.selectionStart-1,1)&&e.dataset.prefix&&e.dispatchEvent(new CustomEvent("request",{detail:e.dataset.prefix}))}}),function(){let t;const n=()=>{t||(t=window.requestAnimationFrame(()=>{t=null,r()}))};window.addEventListener("resize",n),e.addEventListener("wheel",n,{passive:!0})}();const u=t=>{const n=e.scrollLeft,[o,r]=[+e.dataset.from,+e.dataset.to],s=e.value.substr(o,r-o);let[c,l]=[typer.selectionStart,typer.selectionEnd];const u=t(s);if(null==u)return!1;const f=document.activeElement;typer.focus(),typer.selectionStart=o,typer.selectionEnd=r;const p=typer.value.substr(0,o)+u+typer.value.substr(r);document.execCommand("insertText",!1,u)&&typer.value===p||(typer.value=typer.value.substr(0,o)+u+typer.value.substr(r)),typer.dispatchEvent(new CustomEvent("change"));const m=e=>(e>=r?e=e-(r-o)+u.length:e>o&&(e=o+u.length),e);return[a.start,a.end]=[typer.selectionStart,typer.selectionEnd]=[m(c),m(l)],f&&f.focus(),d=!0,e.scrollLeft=n,i(o,o+u.length),!0};e.addEventListener("modifier",e=>{const t={[e.detail.type]:e.detail.code};u(e=>modify(e,t).out||"")}),e.addEventListener("emoji",t=>{const n=t.detail.choice;u(()=>n)&&(e.dataset.word=t.detail.word||"",datasetSafeDelete(e,"prefix"))})}function build(e,t=3,n=10){const o={},r={};return e.forEach(e=>{const i=e[0];r[i]=e.slice(1);const s=i.substr(0,t);for(let t=1;t<=s.length;++t){const e=s.substr(0,t);let r=o[e];r||(r=o[e]=[]),r.length<n&&r.push(i)}}),function(e,n){const i=(e=e.toLowerCase()).substr(t);let s=o[e.substr(0,t)]||[];return i&&(s=s.filter(e=>e.substr(t).startsWith(i))),n||(s=s.filter(t=>t===e)),(s=s.map(e=>[e,...r[e]])).length?s:[]}}function idle(){return new Promise(e=>window.requestIdleCallback(e))}function rAF(e){return void 0!==e?new Promise(t=>{window.setTimeout(()=>window.requestAnimationFrame(t),e)}):new Promise(e=>window.requestAnimationFrame(e))}function delay(e=0){return new Promise(t=>window.setTimeout(t,e))}upgrade(typer);const debouceMap=new Map;function debounce(e,t=0){let n=debouceMap.get(e);if(!n){n={c:e};const t=new Promise(e=>n.r=e);n.p=t.then(()=>(debouceMap.delete(e),n.c())),debouceMap.set(e,n)}return window.clearTimeout(n.t),n.t=window.setTimeout(n.r,Math.max(0,t)),n.p}function removeDuplicates(e){const t=new Set;return e.filter((e,n)=>{if(0!==n){if(t.has(e))return!1;t.add(e)}return!0})}function merge(e,t){const n={};e.forEach((e,t)=>n[e[0]]=t),t.forEach(t=>{const o=n[t[0]];if(void 0===o)return n[t[0]]=e.length,void e.push(t);const r=e[o],i=t.slice(1);e[o]=removeDuplicates(r.concat(i))})}const api="https://emojityper.appspot.com",recentLimit=8,selectionDelay=5e3,getPrefixGen=function(){let e=null;const t=window.localStorage.popular;if(t){let n;try{n=JSON.parse(t)}catch(e){console.debug("couldn't parse localStorage popular",e),n=null}if(n&&(e=Promise.resolve(build(n.results)),n.created>=+new Date-864e5))return()=>e}const n=new Promise((e,t)=>{const n=new XMLHttpRequest;n.open("GET",api+"/popular"),n.onerror=t,n.responseType="json",n.onload=(()=>e(n.response)),n.send()}).then(e=>"string"==typeof e?JSON.parse(e):e);n.then(e=>{window.loader.hidden=!0,e.created=+new Date,window.localStorage.popular=JSON.stringify(e)});const o=n.then(e=>build(e.results));if(!e)return window.loader.hidden=!1,()=>o;let r=e;return o.then(()=>r=o),()=>r}();function request(e,t,n=!1){if(!e){if(n&&""===e){const e=recent();e.unshift("^recent");const t=["^popular"];return Promise.resolve([e,t])}return Promise.resolve([])}const o=getPrefixGen().then(n=>n(e,t));if(!n)return o;let r=`${api}/query?query=${window.encodeURIComponent(e)}`;t&&(r+="&prefix=true");const i=window.fetch(r).then(e=>e.json()).then(e=>e.results);return Promise.all([o,i]).then(e=>{const[t,n]=e;return merge(t,n),t})}const select=function(){let e={};const t=()=>{const t=JSON.stringify(e);return e={},navigator.sendBeacon(api+"/select",t)};return function(n,o){if("^"===n[0])return;const r=recent(),i=r.indexOf(o);return-1!==i&&r.splice(i,1),r.unshift(o),r.splice(8),window.localStorage.recent=r.join(","),e[n]=o,debounce(t,5e3)}}();function submit(e,t){const n=new FormData;return n.append("name",e),n.append("emoji",t),window.fetch(api+"/name",{method:"POST",mode:"cors",body:n})}function recent(){return(window.localStorage.recent||"").split(",").filter(e=>e)}const allowedWorkTime=4,maximumTaskFrame=100;class Worker{constructor(e){this.fn_=e,this.queue_=[],this.waiting_=null,this.runner_().catch(e=>{throw console.info("worker runner failed",e),e})}async runner_(){for(await new Promise(e=>this.waiting_=e),this.waiting_=null,await idle();;){if(this.chunk_())return this.runner_();await rAF()}}chunk_(){const e=window.performance.now();let t=0;for(;this.queue_.length;){const n=this.queue_.shift();if(n.resolve(this.fn_(n.arg)),++t==maximumTaskFrame||window.performance.now()-e>allowedWorkTime)break}return!this.queue_.length}task(e){return new Promise(t=>{this.queue_.push({resolve:t,arg:e}),this.waiting_&&this.waiting_()})}}const prefix="-ok_",ls=window.localStorage,known=new Map;function runner(e){const t=prefix+e;if(ls[t])return!0;const n=isExpectedLength(e);return known.set(e,n),n&&(ls[t]="t"),n}const worker=new Worker(runner);async function valid(e){const t=known.get(e);return void 0!==t?t:worker.task(e)}class ButtonManager{constructor(e){this.holder_=e,this.pendingFirstEmoji_=null,this.options_=new Map,this.buttons_=new Map,this.buttonTarget_=new WeakMap;const t=document.createElement("div");this.holder_.appendChild(t),this.setModifier=(()=>{const e=ButtonManager.optionType_("modifier","gender"),n=ButtonManager.optionType_("modifier","tone");t.appendChild(e),t.appendChild(n);const o=(e,t=null)=>{const n=document.createElement("button");return n.textContent=e,n.dataset.value=t,n},r=[o("\u26ac",""),o("\u2640","f"),o("\u2640\u2642","fm"),o("\u2642","m"),o("\u2642\u2640","mf")],i=[n.appendChild(o("\u2014",""))];for(let t=127995;t<=127999;++t)i.push(o(String.fromCodePoint(t),t));const s=(e,t,n)=>{e?n.appendChild(t):t.remove()};return function(o){const a=t.contains(document.activeElement)?document.activeElement:null;r.forEach(t=>{const n=t.dataset.value.length,r=!n&&o.gender.neutral||1===n&&o.gender.single||2===n&&o.gender.double;s(r,t,e)}),i.forEach(e=>s(o.tone,e,n)),t.insertBefore(e,e.nextSibling),t.insertBefore(n,n.nextSibling),a&&a.focus()}})()}static optionType_(e,t){const n=document.createElement("div");return n.className="options "+e,n.dataset[e]=t,n.dataset.name=t,n}optionForName_(e){const t=this.options_.get(e);if(t)return t;const n=document.createElement("div");return n.className="options",n.setAttribute("data-option",e),"^"===e[0]&&(n.classList.add("special"),e=e.substr(1)),n.setAttribute("data-name",e),n}addEmojiTo_(e,t){let n=this.buttons_.get(t);if(n){const t=this.buttonTarget_.get(n);if(null===t)return n;if(void 0===t)return e.appendChild(n),n}else(n=document.createElement("button")).textContent=t,this.buttons_.set(t,n),valid(t).then(e=>{if(!e)return this.buttonTarget_.set(n,null);const t=this.buttonTarget_.get(n);t.parentNode.replaceChild(n,t),this.buttonTarget_.delete(n),this.pendingFirstEmoji_&&this.pendingFirstEmoji_()});const o=document.createTextNode("");return this.buttonTarget_.set(n,o),e.appendChild(o),n}immediateFirstEmojiForOption_(e){const t=this.options_.get(e),n=t&&t.firstElementChild;return n?n.textContent:null}firstEmojiForOption(e){return new Promise(t=>{const n=()=>{const o=this.immediateFirstEmojiForOption_(e);if(!o)return!1;this.pendingFirstEmoji_===n&&(this.pendingFirstEmoji_=null),t(o)};this.pendingFirstEmoji_=n,n()})}update(e){const t=new Map,n=new Map,o=this.holder_.contains(document.activeElement)?document.activeElement:null;e.forEach(e=>{const o=e[0],r=this.optionForName_(o);t.set(o,r),this.options_.delete(o),this.holder_.appendChild(r);for(let t=0;t<r.children.length;++t){const e=r.children[t],o=e.textContent;n.has(o)?(e.remove(),--t):n.set(o,e)}for(let t,i=1;t=e[i];++i)n.has(t)||n.set(t,this.addEmojiTo_(r,t))}),this.options_.forEach(e=>e.remove()),this.options_=t,this.buttons_=n,o&&(document.body.contains(o)?o.focus():typer.focus())}}let spaceFrame=0;chooser.addEventListener("keyup",e=>{" "===e.key&&"button"===e.target.localName&&(spaceFrame=window.setTimeout(()=>spaceFrame=0,0))});let previousChooserLeft=void 0,duringNavigate=!1;function navigateChooserButtonVertical(e){const t={dist:1/0,button:null},n=document.activeElement.getBoundingClientRect(),o=void 0!==previousChooserLeft?previousChooserLeft:n.left;let r=void 0;for(let i=0;i<e.length;++i){const s=e[i],a=s.getBoundingClientRect();if(n.top===a.top)continue;if(void 0===r)r=a.top;else if(a.top!==r)break;const c=Math.abs(a.left-o);c<t.dist&&([t.dist,t.button]=[c,s])}if(!t.button)return!1;duringNavigate=!0;try{t.button.focus()}finally{duringNavigate=!1}return!0}chooser.addEventListener("focus",e=>{duringNavigate||(previousChooserLeft=document.activeElement.getBoundingClientRect().left)},!0),chooser.addEventListener("click",e=>{previousChooserLeft=void 0;const t=isKeyboardClick(e);let n=void 0;const o=e.target;if("button"!==o.localName);else if(o.parentNode.dataset.modifier){if(e.shiftKey)return;const t="value"in o.dataset?+o.dataset.value||o.dataset.value:null,r={type:o.parentNode.dataset.modifier,code:t};typer.dispatchEvent(new CustomEvent("modifier",{detail:r})),n="modifier"}else if(o.parentNode.dataset.option){if(e.shiftKey){copyText(o.textContent)&&ga("send","event","options","copy");const e=document.scrollingElement.scrollTop;return t?o.focus():typer.focus(),void(document.scrollingElement.scrollTop=e)}const r=0!==spaceFrame||e.metaKey||e.ctrlKey?o.parentNode.dataset.option:null,i={choice:o.textContent,word:r};typer.dispatchEvent(new CustomEvent("emoji",{detail:i})),select(o.parentNode.dataset.option,i.choice),n="emoji"}n&&(ga("send","event","options","click",n),t||typer.focus())}),typer.addEventListener("keydown",e=>{if("ArrowDown"===e.key||"Down"===e.key){const e=typer.getBoundingClientRect();previousChooserLeft=e.left+cursorPosition(typer),navigateChooserButtonVertical(chooser.querySelectorAll("button"))&&ga("send","event","options","keyboardnav")}}),chooser.addEventListener("keydown",e=>{const t=arrowFromEvent(e);if(!t)return;if(!chooser.contains(document.activeElement))return;const n=Array.from(chooser.querySelectorAll("button")),o=n.indexOf(document.activeElement);if(-1===o)return;let r,i;if("ArrowLeft"===t?r=-1:"ArrowRight"===t&&(r=1),r){const e=o+r;e>=0&&e<n.length&&n[e].focus()}else{if("ArrowUp"===t)(i=n.slice(0,o)).reverse();else{if("ArrowDown"!==t)return;i=n.slice(o)}if(navigateChooserButtonVertical(i)||"ArrowUp"===t&&typer.focus(),"ArrowDown"===t){const t=document.activeElement.getBoundingClientRect(),n=t.top+t.height;window.innerHeight-n>64&&e.preventDefault()}}}),function(){const e=new ButtonManager(chooser);let t={},n=performance.now(),o=null;typer.addEventListener("query",r=>{const i=modify(!r.detail.prefix&&r.detail.focus||"");e.setModifier(i),o=null;let s=!1;const a=performance.now(),c=r.detail;t.text&&t.prefix===c.prefix?a-n>2e3&&(s=!0):s=!0,t=c,n=a;const l=async(n=0,o=!1)=>{if(n&&(await rAF(n),t!==c))return-1;const r=await request(c.text,c.prefix,o);return t!==c?-1:e.update(r)};l(s?0:250).then(e=>{if(e<0)return-2;if(!c.text)return l(1500,!0);const t=Math.max(1e3,100*Math.pow(e,.75));return l(t,!0)}).catch(e=>{console.error("error doing request",e)})});const r=/[^\w:\.,$%^\-']+/g;typer.addEventListener("request",t=>{const n=(e=>e.replace(r,"").toLowerCase())(t.detail||""),i=e.firstEmojiForOption(n);o=i,i.then(e=>{if(o!==i)return;ga("send","event","options","typing");const t={choice:e,word:n};typer.dispatchEvent(new CustomEvent("emoji",{detail:t}))})})}(),function(e,t){const n=t.querySelector("form"),o=n.querySelector("input"),r=n.querySelector("button");let i="",s=null;e.addEventListener("query",e=>{const n=e.detail,r=null===n.text&&void 0!==n.focus&&n.selection;if(i=n.focus,!r)return s||(o.value="",t.hidden=!0),!1;t.hidden=!1});const a=e=>{r.disabled=!o.value};"input change".split(/\s+/).forEach(e=>o.addEventListener(e,a)),n.addEventListener("submit",e=>{if(e.preventDefault(),s)return!1;n.classList.add("pending"),o.disabled=!0,r.disabled=!0;(s=submit(o.value,i).then(e=>{if(!e.ok)throw new Error(e.status);return r.classList.add("success"),!1}).catch(e=>(r.classList.add("failure"),console.warn("failed to submit emoji",e),!0)).then(e=>{n.classList.remove("pending"),o.disabled=!1,o.value="",o.dispatchEvent(new CustomEvent("change")),s=null,i||(t.hidden=!0)})).then(()=>delay(2e3)).then(()=>{r.className=""})})}(typer,advanced);const value=e=>{const t=e.detail.trim();document.body.classList.toggle("has-value",Boolean(t))};typer.addEventListener("value",value),value({detail:typer.value}),document.body.addEventListener("keydown",e=>{switch(e.key){case"Escape":typer.focus()}});const resize=e=>{const t=window.innerHeight;document.body.style.minHeight=`${t}px`};window.addEventListener("resize",resize),window.addEventListener("load",resize),resize();let deferredPrompt=null;function cleanupPrompt(){document.body.classList.remove("has-install"),deferredPrompt=null}window.addEventListener("beforeinstallprompt",e=>(ga("send","event","install","available"),document.body.classList.add("has-install"),deferredPrompt=e,e.preventDefault(),!1)),window.addEventListener("appinstalled",e=>{ga("send","event","install","installed"),cleanupPrompt()});const installEl=document.getElementById("install");installEl.addEventListener("click",e=>{deferredPrompt&&(deferredPrompt.prompt(),deferredPrompt.userChoice&&deferredPrompt.userChoice.then(e=>{ga("send","event","install",e)}).catch(e=>{console.warn("beforeinstallprompt prompt",e)}).then(cleanupPrompt))});const adverts=document.getElementById("adverts");function refresh(){const e=adverts.querySelector(".active"),t=e&&e.nextElementSibling||adverts.firstElementChild;t?(e&&e.classList.remove("active"),t.classList.add("active"),enqueue()):console.warn("no adverts to choose from")}let timeout;function enqueue(){window.clearTimeout(timeout),timeout=window.setTimeout(()=>{window.requestAnimationFrame(refresh)},1e4)}enqueue(),navigator.serviceWorker&&(navigator.serviceWorker.register("./sw.js").catch(e=>{console.warn("failed to register SW",e)}),navigator.serviceWorker.addEventListener("controllerchange",()=>{navigator.serviceWorker.controller||(console.info("got SW controllerchange, reload"),window.location.reload())}));let prevOnLine=!0;function notifyStatus(){"onLine"in navigator&&prevOnLine!==navigator.onLine&&(ga("send","event","network",navigator.onLine?"online":"offline"),prevOnLine=navigator.onLine)}notifyStatus(),window.addEventListener("online",()=>debounce(notifyStatus)),window.addEventListener("offline",()=>debounce(notifyStatus));

//# sourceMappingURL=bundle-9fadbf0a13.js.map
